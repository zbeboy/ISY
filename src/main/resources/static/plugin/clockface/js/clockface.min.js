!function(t){var e=function(e,i){this.$element=t(e),this.options=t.extend({},t.fn.clockface.defaults,i,this.$element.data()),this.init()};e.prototype={constructor:e,init:function(){this.$clockface=t(t.fn.clockface.template),this.$clockface.find(".l1 .cell, .left.cell").html('<div class="outer"></div><div class="inner"></div>'),this.$clockface.find(".l5 .cell, .right.cell").html('<div class="inner"></div><div class="outer"></div>'),this.$clockface.hide(),this.$outer=this.$clockface.find(".outer"),this.$inner=this.$clockface.find(".inner"),this.$ampm=this.$clockface.find(".ampm"),this.ampm=null,this.hour=null,this.minute=null,this.$ampm.click(t.proxy(this.clickAmPm,this)),this.$clockface.on("click",".cell",t.proxy(this.click,this)),this.parseFormat(),this.prepareRegexp(),this.ampmtext=this.is24?{am:"12-23",pm:"0-11"}:{am:"AM",pm:"PM"},this.isInline=this.$element.is("div"),this.isInline?this.$clockface.addClass("clockface-inline").appendTo(this.$element):(this.$clockface.addClass("dropdown-menu").appendTo("body"),"focus"===this.options.trigger&&this.$element.on("focus.clockface",t.proxy(function(t){this.show()},this)),t(document).off("click.clockface").on("click.clockface",t.proxy(function(e){t(e.target).closest(".clockface").length||t(".clockface-open").each(function(){this!==e.target&&t(this).clockface("hide")})},this))),this.fill("minute")},show:function(e){this.$clockface.is(":visible")||(this.isInline||(void 0===e&&(e=this.$element.val()),this.$element.addClass("clockface-open"),this.$element.on("keydown.clockface",t.proxy(this.keydown,this)),this.place(),t(window).on("resize.clockface",t.proxy(this.place,this))),this.$clockface.show(),this.setTime(e),this.$element.triggerHandler("shown.clockface",this.getTime(!0)))},hide:function(){this.$clockface.hide(),this.isInline||(this.$element.removeClass("clockface-open"),this.$element.off("keydown.clockface"),t(window).off("resize.clockface")),this.$element.triggerHandler("hidden.clockface",this.getTime(!0))},toggle:function(t){this.$clockface.is(":visible")?this.hide():this.show(t)},setTime:function(t){var e,i,s,n="am";if(void 0===t)return void(null===this.ampm&&this.setAmPm("am"));t instanceof Date&&(i=t.getHours(),s=t.getMinutes()),"string"==typeof t&&t.length&&(e=this.parseTime(t),24===e.hour&&(e.hour=0),i=e.hour,s=e.minute,n=e.ampm),i>11&&i<24?(n="pm",!this.is24&&i>12&&(i-=12)):i>=0&&i<11&&(this.is24||0===i)&&(n="am"),this.setAmPm(n),this.setHour(i),this.setMinute(s)},setAmPm:function(t){t!==this.ampm&&(this.ampm="am"===t?"am":"pm",this.$ampm.text(this.ampmtext[this.ampm]),this.fill("hour"),this.highlight("hour"))},setHour:function(t){t=parseInt(t,10),t=isNaN(t)?null:t,(t<0||t>23)&&(t=null),t!==this.hour&&(this.hour=t,this.highlight("hour"))},setMinute:function(t){t=parseInt(t,10),t=isNaN(t)?null:t,(t<0||t>59)&&(t=null),t!==this.minute&&(this.minute=t,this.highlight("minute"))},highlight:function(e){var i,s=this.getValues(e),n="minute"===e?this.minute:this.hour,c="minute"===e?this.$outer:this.$inner;c.removeClass("active"),(i=t.inArray(n,s))>=0&&c.eq(i).addClass("active")},fill:function(e){var i=this.getValues(e),s="minute"===e;("minute"===e?this.$outer:this.$inner).each(function(e){var n=i[e];s&&n<10&&(n="0"+n),t(this).text(n)})},getValues:function(e){var i=[11,0,1,10,2,9,3,8,4,7,6,5],s=i.slice();return"minute"===e?t.each(i,function(t,e){s[t]=5*e}):(this.is24||(s[1]=12),this.is24&&"pm"===this.ampm&&t.each(i,function(t,e){s[t]=e+12})),s},click:function(e){var i=t(e.target),s=i.hasClass("active")?null:i.text();i.hasClass("inner")?this.setHour(s):this.setMinute(s),this.isInline||this.$element.val(this.getTime()),this.$element.triggerHandler("pick.clockface",this.getTime(!0))},clickAmPm:function(t){t.preventDefault(),this.setAmPm("am"===this.ampm?"pm":"am"),this.isInline||this.is24||this.$element.val(this.getTime()),this.$element.triggerHandler("pick.clockface",this.getTime(!0))},place:function(){var e=parseInt(this.$element.parents().filter(function(){return"auto"!=t(this).css("z-index")}).first().css("z-index"),10)+10,i=this.$element.offset();this.$clockface.css({top:i.top+this.$element.outerHeight(),left:i.left,zIndex:e})},keydown:function(e){if(/^(9|27|13)$/.test(e.which))return void this.hide();clearTimeout(this.timer),this.timer=setTimeout(t.proxy(function(){this.setTime(this.$element.val())},this),500)},parseFormat:function(){var e=this.options.format,i="HH",s="mm";t.each(["HH","hh","H","h"],function(t,s){if(e.indexOf(s)!==-1)return i=s,!1}),t.each(["mm","m"],function(t,i){if(e.indexOf(i)!==-1)return s=i,!1}),this.is24=i.indexOf("H")!==-1,this.hFormat=i,this.mFormat=s},parseTime:function(e){var i,s=null,n=null,c="am",l=[];if(e=t.trim(e),this.regexpSep&&(l=e.match(this.regexpSep)),l&&l.length)s=l[1]?parseInt(l[1],10):null,n=l[2]?parseInt(l[2],10):null,c=l[3]&&"a"!==l[3].toLowerCase()?"pm":"am";else if(e=e.split("").reverse().join("").replace(/\s/g,""),(l=e.match(this.regexpNoSep))&&l.length)switch(c=l[1]&&"a"!==l[1].toLowerCase()?"pm":"am",i=l[2].split("").reverse().join(""),i.length){case 1:s=parseInt(i,10);break;case 2:s=parseInt(i,10),s>24&&(s=parseInt(i[0],10),n=parseInt(i[1],10));break;case 3:s=parseInt(i[0],10),n=parseInt(i[1]+i[2],10),n>59&&(s=parseInt(i[0]+i[1],10),n=parseInt(i[2],10),s>24&&(s=null,n=null));break;case 4:s=parseInt(i[0]+i[1],10),n=parseInt(i[2]+i[3],10),s>24&&(s=null),n>59&&(n=null)}return{hour:s,minute:n,ampm:c}},prepareRegexp:function(){var t=this.options.format.match(/h\s*([^hm]?)\s*m/i);t&&t.length&&(t=t[1]),this.separator=t,this.regexpSep=this.separator&&this.separator.length?new RegExp("(\\d\\d?)\\s*\\"+this.separator+"\\s*(\\d?\\d?)\\s*(a|p)?","i"):null,this.regexpNoSep=new RegExp("(a|p)?\\s*(\\d{1,4})","i")},getTime:function(t){if(t===!0)return{hour:this.hour,minute:this.minute,ampm:this.ampm};var e=null!==this.hour?this.hour+"":"",i=null!==this.minute?this.minute+"":"",s=this.options.format;return e.length||i.length?(this.hFormat.length>1&&1===e.length&&(e="0"+e),this.mFormat.length>1&&1===i.length&&(i="0"+i),!i.length&&this.separator&&(s=s.replace(this.separator,"")),s=s.replace(this.hFormat,e).replace(this.mFormat,i),this.is24||(s=s.indexOf("A")!==-1?s.replace("A",this.ampm.toUpperCase()):s.replace("a",this.ampm)),s):""},destroy:function(){this.hide(),this.$clockface.remove(),this.isInline||"focus"!==this.options.trigger||this.$element.off("focus.clockface")}},t.fn.clockface=function(i){var s,n=Array.apply(null,arguments);return n.shift(),"getTime"===i&&this.length&&(s=this.eq(0).data("clockface"))?s.getTime.apply(s,n):this.each(function(){var s=t(this),c=s.data("clockface"),l="object"==typeof i&&i;c||s.data("clockface",c=new e(this,l)),"string"==typeof i&&"function"==typeof c[i]&&c[i].apply(c,n)})},t.fn.clockface.defaults={format:"H:mm",trigger:"focus"},t.fn.clockface.template='<div class="clockface"><div class="l1"><div class="cell"></div><div class="cell"></div><div class="cell"></div></div><div class="l2"><div class="cell left"></div><div class="cell right"></div></div><div class="l3"><div class="cell left"></div><div class="cell right"></div><div class="center"><a href="#" class="ampm"></a></div></div><div class="l4"><div class="cell left"></div><div class="cell right"></div></div><div class="l5"><div class="cell"></div><div class="cell"></div><div class="cell"></div></div></div>'}(window.jQuery);